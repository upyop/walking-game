<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Walk + Core Quest</title>
  <link href="https://fonts.googleapis.com/css2?family=DotGothic16&display=swap" rel="stylesheet">
  <style>
    :root{
      --accent:#10B96A;
      --bg:#2A2C35;           /* ç”»é¢èƒŒæ™¯ */
      --panel:#2F323C;        /* ã‚«ãƒ¼ãƒ‰èƒŒæ™¯ */
      --panel-2:#2A2D36;      /* æ¿ƒæ·¡å·®ç”¨ */
      --text:#E8EEF5;         /* æœ¬æ–‡è‰² */
      --muted:#C7CDD8;        /* ãƒ©ãƒ™ãƒ«è‰² */
      --muted-80: rgba(199,205,216,.8);
      --line: rgba(255,255,255,.18);
      --line-weak: rgba(255,255,255,.12);
      --ring: rgba(16,185,106,.35);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{      margin:0; font-family:'DotGothic16', sans-serif;
      color:var(--text); background:var(--bg);
    }
    .wrap{max-width:480px;margin:32px auto;padding:0 20px}
    .frame{background:var(--panel); border:1px solid var(--line); border-radius:14px; padding:32px}

    /* è¦‹å‡ºã— */
    .title{font-size:22px; text-align:center; margin:0 0 18px}

    /* åµï¼ˆ3Dé¢¨ï¼‰ */
    .eggArea{ display:flex; flex-direction:column; align-items:center; justify-content:center; gap:24px }
    .eggEmoji{ font-size:96px; line-height:1; display:flex; align-items:center; justify-content:center; width:100%; }

    /* ãƒ¬ãƒ™ãƒ«è¡¨ç¤ºï¼†ãƒãƒ¼ */
    .levelRow{ display:flex; flex-direction:column; align-items:stretch; gap:10px; width:100%; }
    .levelText{font-size:12px; text-align:center; color:var(--muted-80); margin-top:12px}
    .bar{height:10px; border-radius:8px; background:linear-gradient(180deg,#3a3e4a,#333745); border:1px solid var(--line); overflow:hidden}
    .bar>span{display:block; height:100%; width:0; background:linear-gradient(90deg,#8ef0b8,#3bd07f); transition:width .5s ease; border-radius:inherit}
    .levelRow .bar{ width:100%; }

    /* ã‚»ã‚¯ã‚·ãƒ§ãƒ³åŒºåˆ‡ã‚Š */
    .sep{height:1px; border-top:1px dashed var(--line); margin:28px 0}

    /* ãƒ©ãƒ™ãƒ«ï¼†å…¥åŠ› */
    .secTitle{display:flex;align-items:center;gap:8px; color:var(--muted-80); margin:0 0 14px; font-size:14px}
    label{display:block; color:var(--muted-80); margin-bottom:6px; font-size:13px}

    .inputBox{display:flex; align-items:center; gap:8px; background:var(--panel-2); border:1px solid var(--line); border-radius:10px; padding:12px 14px;}
    .inputBox input{flex:1; background:transparent; border:0; outline:0; color:var(--text); font-size:14px}
    .suffix{color:var(--muted-80); font-size:13px}

    /* ãƒˆã‚°ãƒ«ãƒœã‚¿ãƒ³ï¼ˆé€æ˜ãƒ»ç·šã®ã¿ï¼‰ */
    .toggles{display:flex; flex-direction:column; gap:10px}
    .toggle{display:flex; align-items:center; justify-content:center; gap:8px; height:44px;
      background:transparent; color:var(--text); border:1px solid var(--line); border-radius:10px; cursor:pointer}
    .toggle.active{outline:2px solid var(--accent); outline-offset:-2px; border-color:rgba(16,185,106,.55)}

    /* ãƒ¡ã‚¤ãƒ³ãƒœã‚¿ãƒ³ */
    .btn{display:flex;align-items:center;justify-content:center;height:44px;width:100%;background:linear-gradient(90deg,#3bd07f,#10B96A);border:1px solid rgba(16,185,106,.55);color:#0b1a10;border-radius:10px;cursor:pointer;box-shadow:0 6px 18px var(--ring);}
    .btn:hover{filter:brightness(1.05)}

    /* KPIã‚«ãƒ¼ãƒ‰ */
    .kpis{display:flex; flex-direction:column; gap:12px; margin-top:14px}
    .kpi{display:flex; justify-content:space-between; align-items:center; background:var(--panel-2);
      border:1px solid var(--line); border-radius:10px; padding:12px}
    .kpi h3{margin:0; font-size:20px}
    .kpi p{margin:2px 0 0; font-size:12px; color:var(--muted-80)}
    .kpi .ico{font-size:18px; opacity:.9}

    /* ç®‡æ¡æ›¸ã */
    ul{margin:6px 0 0 0; padding-left:18px}
    li{margin:6px 0; color:var(--text)}

    /* ãƒˆãƒ¼ã‚¹ãƒˆ */
    .toast{position:fixed; bottom:14px; left:0; right:0; display:flex; justify-content:center}
    .toast>div{background:rgba(16,185,106,.14); border:1px solid rgba(16,185,106,.45); color:#cfe6d9; padding:8px 12px; border-radius:10px; opacity:0; transform:translateY(6px); transition:all .35s ease}

    /* ãƒ•ã‚©ãƒ³ãƒˆçµ±ä¸€ */
    button, input, select, textarea { font-family: 'DotGothic16', sans-serif; }

    /* æ—¥ä»˜å…¥åŠ›ï¼ˆå¿…è¦æ™‚ç”¨ï¼‰*/
    input[type="date"]{color:var(--muted-80)}
    input[type="date"]::-webkit-calendar-picker-indicator{ filter: invert(86%) sepia(6%) saturate(90%) hue-rotate(180deg) brightness(96%); opacity:.8 }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="frame">
      <h1 class="title">Walk + Core Quest</h1>

      <!-- åµï¼†ãƒ¬ãƒ™ãƒ«è¡¨ç¤º -->
      <div class="eggArea">
        <div class="eggEmoji" id="eggVisual" aria-label="egg">ğŸ¥š</div>
        <div class="levelRow">
          <div class="bar"><span id="levelBar"></span></div>
          <div class="levelText" id="levelText">Lv. 1 ãƒ» ç´¯è¨ˆ 0 XP / æ¬¡ã®ãƒ¬ãƒ™ãƒ«ã¾ã§ 200 XP</div>
        </div>
      </div>

      <div class="sep"></div>

      <!-- ä»Šæ—¥ã®è¨˜éŒ² -->
      <h2 class="secTitle">ğŸ“Œ ä»Šæ—¥ï¼ˆ<span id="todayStr"></span>ï¼‰ã®è¨˜éŒ²</h2>
      <div style="margin-bottom:12px">
        <label>ğŸš¶â€â™€ï¸ æ­©ã„ãŸè·é›¢</label>
        <div class="inputBox">
          <input id="km" type="number" min="0" step="0.1" placeholder="ä¾‹: 2.5" />
          <span class="suffix">km</span>
        </div>
      </div>
      <div>
        <label>ğŸ‹ï¸ ç­‹ãƒˆãƒ¬</label>
        <div class="toggles" id="toggles">
          <button class="toggle" data-key="plank">ãƒ—ãƒ©ãƒ³ã‚¯30ç§’</button>
          <button class="toggle" data-key="legraise">ãƒ¬ãƒƒã‚°ãƒ¬ã‚¤ã‚º10å›</button>
          <button class="toggle" data-key="hiplift">ãƒ’ãƒƒãƒ—ãƒªãƒ•ãƒˆ10å›</button>
        </div>
      </div>
      <div style="height:14px"></div>
      <button class="btn" id="addBtn">è¨˜éŒ²ã™ã‚‹</button>

      <div class="sep"></div>

      <!-- ã‚µãƒãƒªãƒ¼ -->
      <h2 class="secTitle" style="justify-content:center">ã‚µãƒãƒªãƒ¼</h2>
      <div class="kpis">
        <div class="kpi">
          <div>
            <h3 id="kpiKm">0.0 km</h3>
            <p>ä»Šé€±ã®åˆè¨ˆè·é›¢</p>
          </div>
          <div class="ico">ğŸ§â€â™€ï¸</div>
        </div>
        <div class="kpi">
          <div>
            <h3 id="kpiXp">0 XP</h3>
            <p>ä»Šé€±ã®XP</p>
          </div>
          <div class="ico">ğŸ’</div>
        </div>
        <div class="kpi">
          <div>
            <h3 id="kpiDays">0 / 7</h3>
            <p>é‹å‹•ã—ãŸæ—¥</p>
          </div>
          <div class="ico">ğŸ“…</div>
        </div>
      </div>

      <div class="sep"></div>

      <!-- ä»Šé€±ã®ã‚¹ãƒ—ãƒªãƒ³ãƒˆ -->
      <h2 class="secTitle">ğŸ“† ä»Šé€±ã®ã‚¹ãƒ—ãƒªãƒ³ãƒˆï¼ˆå¤œå‹ãƒ»ãŠè…¹é‡ç‚¹ï¼‰</h2>
      <ul id="sprintInfo" class="muted">
        <li>å¯¾è±¡æœŸé–“ï¼š<span id="spanPeriod"></span></li>
        <li>ç›®æ¨™ï¼š4æ—¥ / 8kmï¼ˆã‚¦ã‚©ãƒ¼ã‚­ãƒ³ã‚°ï¼‰</li>
        <li>ãƒ¡ãƒ¢ï¼šã‚¦ã‚©ãƒ¼ãƒ ã‚¢ãƒƒãƒ—é‡è¦–ã€‚ç­‹ãƒˆãƒ¬ã¯ãƒ—ãƒ©ãƒ³ã‚¯ã ã‘ã§ã‚‚</li>
      </ul>
      <div style="height:12px"></div>
      <label>âœ… ä»Šé€±ã®é”æˆç‡</label>
      <div class="bar"><span id="sprintBar"></span></div>
      <div class="levelText" id="sprintHint">å®Ÿç¸¾ï¼š0.0 km / 0æ—¥</div>

      <div class="sep"></div>

      <!-- ãƒ­ã‚° -->
      <h2 class="secTitle">ğŸ—’ ãƒ­ã‚°</h2>
      <ul id="logList" style="color:var(--muted-80)">
        <!-- ã“ã“ã«è¿½åŠ  -->
      </ul>
    </div>
  </div>

  <div class="toast"><div id="toast">ä¿å­˜ã—ã¾ã—ãŸï¼</div></div>

  <script>
    // ====== ãƒ‡ãƒ¼ã‚¿ ======
    const XP_PER_KM = 10, XP_PLANK=5, XP_LEG=5, XP_HIP=5, LEVEL_STEP=200;
    const state = { entries: [], prevLevel:1 };

    const $ = (s)=>document.querySelector(s); const $$ = (s)=>Array.from(document.querySelectorAll(s));
    const fmt1 = (n)=> (Math.round(n*10)/10).toFixed(1);

    // ä»Šæ—¥ã®ãƒ†ã‚­ã‚¹ãƒˆ
    function formatToday(){
      const d=new Date();
      const y=d.getFullYear(), m=d.getMonth()+1, day=d.getDate();
      const wk=['Sun','Mon','Tue','Wed','Thu','Fri','Sat'][d.getDay()];
      return `${y}.${String(m).padStart(2,'0')}.${String(day).padStart(2,'0')} ${wk}`;
    }

    function startOfWeek(d=new Date()){
      const dt=new Date(d); const day=dt.getDay(); const diff=(day+6)%7; dt.setDate(dt.getDate()-diff); dt.setHours(0,0,0,0); return dt;
    }
    function endOfWeek(d=new Date()){ const s=startOfWeek(d); const e=new Date(s); e.setDate(e.getDate()+7); return e; }

    function calcXp(en){ let xp=(Number(en.km)||0)*XP_PER_KM; if(en.plank)xp+=XP_PLANK; if(en.legraise)xp+=XP_LEG; if(en.hiplift)xp+=XP_HIP; return Math.round(xp); }

    function toast(msg){ const t=$('#toast'); t.textContent=msg; requestAnimationFrame(()=>{ t.style.opacity=1; t.style.transform='translateY(0)'; setTimeout(()=>{ t.style.opacity=0; t.style.transform='translateY(6px)'; }, 1400); }); }

    function refresh(){
      // KPIï¼ˆä»Šé€±ï¼‰
      const s=startOfWeek(), e=endOfWeek();
      const week=state.entries.filter(en=>{ const d=new Date(en.date); return d>=s && d<e; });
      const byDate=new Map();
      let sumKm=0, sumXp=0, days=0;
      week.forEach(en=>{ const key=en.date; const val=byDate.get(key)||{km:0,xp:0,has:false}; val.km+=Number(en.km||0); val.xp+=calcXp(en); val.has=true; byDate.set(key,val); });
      byDate.forEach(v=>{ sumKm+=v.km; sumXp+=v.xp; days+=(v.has?1:0) });

      $('#kpiKm').textContent = `${fmt1(sumKm)} km`;
      $('#kpiXp').textContent = `${Math.round(sumXp)} XP`;
      $('#kpiDays').textContent = `${days} / 7`;

      // ãƒ¬ãƒ™ãƒ«ï¼ˆç´¯è¨ˆï¼‰
      const totalXp = state.entries.reduce((s,en)=> s + calcXp(en), 0);
      const level = Math.floor(totalXp/LEVEL_STEP) + 1; const cur = totalXp % LEVEL_STEP;
      // width is set below to match sprint bar design
      
      $('#levelText').textContent = `Lv. ${level} ãƒ» ç´¯è¨ˆ ${totalXp} XP / æ¬¡ã®ãƒ¬ãƒ™ãƒ«ã¾ã§ ${LEVEL_STEP-cur} XP`;
      // åŒãƒ‡ã‚¶ã‚¤ãƒ³åŒ–ï¼šåµä¸‹ã®ãƒãƒ¼ã‚‚ä»Šé€±ã®é”æˆç‡ãƒãƒ¼ã¨åŒã˜ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆ%æŒ‡å®šï¼‰ã«çµ±ä¸€
      $('#levelBar').style.width = Math.min(100, Math.round((cur/LEVEL_STEP)*100)) + '%';

      // åµã®æ®µéšï¼ˆçµµæ–‡å­—ï¼‰+ æœ€çµ‚ã¯ãƒ©ãƒ³ãƒ€ãƒ 
      const egg = $('#eggVisual');
      const finals = ['ğŸ“','ğŸ†','ğŸŒŸ','ğŸš€','ğŸ¦„','ğŸ¦…','ğŸ‰','ğŸ§¿','ğŸ¯','ğŸ”¥','ğŸ›¡ï¸','ğŸ§ ','ğŸ’ª'];
      const symbol = level>=7 ? finals[(Math.floor(totalXp/LEVEL_STEP)) % finals.length]
                              : level>=5 ? 'ğŸ¥'
                              : level>=3 ? 'ğŸ£'
                              : 'ğŸ¥š';
      egg.textContent = symbol;
      if(level>state.prevLevel){ state.prevLevel=level; toast('ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ï¼'); }

      // ã‚¹ãƒ—ãƒªãƒ³ãƒˆ
      const eDisp = new Date(endOfWeek()); eDisp.setDate(eDisp.getDate()-1);
      $('#spanPeriod').textContent = `${startOfWeek().getFullYear()}/${startOfWeek().getMonth()+1}/${startOfWeek().getDate()} ã€œ ${eDisp.getFullYear()}/${eDisp.getMonth()+1}/${eDisp.getDate()}`;
      $('#sprintBar').style.width = Math.min(100, Math.round((sumKm/8)*100)) + '%';
      $('#sprintHint').textContent = `å®Ÿç¸¾ï¼š${fmt1(sumKm)} km / ${days}æ—¥`;

      // ãƒ­ã‚°
      const log=$('#logList'); log.innerHTML='';
      const sorted=[...state.entries].sort((a,b)=> a.date<b.date?1:(a.date>b.date?-1:0));
      sorted.slice(0,30).forEach(en=>{
        const acts=[]; if(en.plank)acts.push('ãƒ—ãƒ©ãƒ³ã‚¯'); if(en.legraise)acts.push('ãƒ¬ãƒƒã‚°ãƒ¬ã‚¤ã‚º'); if(en.hiplift)acts.push('ãƒ’ãƒƒãƒ—ãƒªãƒ•ãƒˆ');
        const li=document.createElement('li'); li.textContent = `${en.date}  ${fmt1(Number(en.km||0))}km  ${acts.join('/')}`; log.appendChild(li);
      });
    }

    function add(){
      const date = new Date().toISOString().slice(0,10);
      const km = Number($('#km').value||0);
      const entry = {date, km, plank:false, legraise:false, hiplift:false};
      $$('#toggles .toggle.active').forEach(el=> entry[el.dataset.key]=true);
      if(km<=0 && !entry.plank && !entry.legraise && !entry.hiplift){ toast('è·é›¢ã‹ç­‹ãƒˆãƒ¬ã®ã©ã¡ã‚‰ã‹ã‚’è¨˜éŒ²ã—ã¦ã­'); return; }
      state.entries.push(entry);
      $('#km').value=''; $$('#toggles .toggle').forEach(el=>el.classList.remove('active'));
      refresh(); toast('ä¿å­˜ã—ã¾ã—ãŸï¼');
    }

    function init(){
      $('#todayStr').textContent = formatToday();
      $$('#toggles .toggle').forEach(el=> el.addEventListener('click', ()=> el.classList.toggle('active')));
      $('#addBtn').addEventListener('click', add);
      refresh();
    }

    init();
  </script>
</body>
</html>
